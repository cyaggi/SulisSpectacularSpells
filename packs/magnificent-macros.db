{"name":"Whirlpool Warp","type":"script","scope":"global","author":"WskHohnEKJHmL1sC","img":"modules/sulis-spectacular-spells/images/Vortex_01_Regular_Blue_Thumb.webp","command":"// requires Warpgate, Sequencer, and JB2A patreon module\n\nlet distanceAvailable = 500;\nlet icon = 'icons/magic/control/silhouette-grow-shrink-blue.webp';\nlet updateItem = async () => {};\n\nif (typeof item !== 'undefined') {\n    distanceAvailable = item.data.data.uses.value;\n    icon = item.data.img;\n    updateItem = async () => {\n        const updatedCharges = item.data.data.uses.value - crosshairsDistance / 5;\n        await item.update({ 'data.uses.value': updatedCharges });\n    };\n}\n\nlet crosshairsDistance = 0;\nconst checkDistance = async (crosshairs) => {\n    while (crosshairs.inFlight) {\n        //wait for initial render\n        await warpgate.wait(100);\n\n        const ray = new Ray(token.center, crosshairs);\n        const distance = canvas.grid.measureDistances([{ ray }], { gridSpaces: true })[0];\n\n        //only update if the distance has changed\n        if (crosshairsDistance !== distance) {\n            crosshairsDistance = distance;\n            if (distance > distanceAvailable) {\n                crosshairs.icon = 'icons/svg/hazard.svg';\n            } else {\n                crosshairs.icon = icon;\n            }\n\n            crosshairs.draw();\n            crosshairs.label = `${distance} ft`;\n        }\n    }\n}\n\nconst location = await warpgate.crosshairs.show(\n    {\n        // swap between targeting the grid square vs intersection based on token's size\n        interval: token.data.width % 2 === 0 ? 1 : -1,\n        size: token.data.width,\n        icon: icon,\n        label: '0 ft.',\n    },\n    {\n        show: checkDistance\n    },\n);\n\nif (location.cancelled || crosshairsDistance > distanceAvailable) {\n    return;\n}\n\nconst seq = new Sequence().effect()\n    .file(\"jb2a.template_circle.whirl.intro.blue\") \n    .atLocation(token)\n    .zIndex(1)\n    .scale(0.25)\n    .delay(200)\nseq.effect()\n    .file(\"jb2a.template_circle.vortex.intro.blue\")\n    .scale(0.5)\n    .atLocation(token)\n    .zIndex(2)\n    .waitUntilFinished(-1000)\n    .fadeOut(1000)\nseq.effect()\n    .file(\"jb2a.template_circle.vortex.outro.blue\") //Edit this line to customize the outro animation.\n    .scale(0.5)\n    .atLocation(token)\n    .zIndex(2)\n    \n    .thenDo(async () => { await updateItem(); });\nseq.animation()\n    .on(token)\n    .fadeOut(500)\n    .duration(500)\n    .waitUntilFinished();\nseq.animation()\n    .on(token)\n    .teleportTo(location, { relativeToCenter: true })\n    .waitUntilFinished();\nseq.animation()\n    .on(token)\n    .fadeIn(1000)\n    .waitUntilFinished(-999);\nseq.effect()\n    .file(\"jb2a.template_circle.whirl.intro.blue\") \n    .atLocation(token)\n    .zIndex(1)\n    .scale(0.25)\n    .delay(200)\nseq.effect()\n    .file(\"jb2a.template_circle.vortex.intro.blue\")\n    .scale(0.5)\n    .atLocation(token)\n    .zIndex(2)\n    .waitUntilFinished(-1000)\n    .fadeOut(1000)\nseq.effect()\n    .file(\"jb2a.template_circle.vortex.outro.blue\") //Edit this line to customize the outro animation.\n    .scale(0.5)\n    .atLocation(token)\n    .zIndex(2)\nawait seq.play();","ownership":{"default":0,"WskHohnEKJHmL1sC":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.YL8sQTdAyL3rAoVW"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1672708680619,"modifiedTime":1673045047726,"lastModifiedBy":"WskHohnEKJHmL1sC"},"folder":null,"sort":0,"_id":"xAdf0KU1c9Y48wKn"}
{"name":"Spiritual Weapon","type":"script","scope":"global","author":"WskHohnEKJHmL1sC","img":"modules/sulis-spectacular-spells/images/Trinni%27s%20green%20spiritual%20weapon.webp","command":"// You need the Warpgate module and an actor named \"Goblin\" in your Actors Tab for this macro to work. You can change the creature's name below.\n// You also need the Sequencer module and the JB2A module of course !\nconst creatureName = \"Trinni's Spiritual Weapon\";\nconst [spawnedCreature] = await warpgate.spawn(creatureName, { token: { alpha: 0 }}); // This will spawn a token from the \"Goblin\" actor with an opacity of 0.\nconsole.log(spawnedCreature);\nconst tokenD = canvas.tokens.get(spawnedCreature);\nconsole.log(tokenD);\nconst effectScale = 1;\nconst tokenSize = (tokenD.data.width + tokenD.data.height) /2;\nnew Sequence()\n//Will play the intro sequence of the red evocation magic circle animation.\n    .effect()\n        .file(\"jb2a.cure_wounds.200px.purple\")\n        .scale(effectScale * tokenSize)\n        .atLocation(tokenD)\n        .belowTokens() \n        //.waitUntilFinished(-600)\n//Then it will transition to the loop sequence of the red evocation magic circle animation.\n/*\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.conjuration.loop.dark_red\")\n        .scale(effectScale * tokenSize)\n        .atLocation(tokenD)\n        .belowTokens() \n        .fadeIn(200)\n        .fadeOut(200)\n        .waitUntilFinished(-2550)\n        \n//This is an animation that will \"hide\" the apparition of the token\n    .effect()\n        .file(\"jb2a.divine_smite.target.dark_red\")\n        .scale(0.5 * tokenSize)\n        .atLocation(tokenD)\n        .waitUntilFinished(-1500)\n        */\n        \n//Let's bring the opacity of the token back whilst the Divine Smite animation is here\n    .animation()\n        .delay(400)\n        .on(tokenD)\n        .fadeIn(500)\n        .opacity(1.0)\n        \n//Finally it will play the outro sequence of the red evocation magic circle animation as follow : jb2a.magic_signs.circle.02.schoolofmagicname.outro.color\n/*\n    .effect()\n        .file(\"jb2a.magic_signs.circle.02.conjuration.outro.dark_red\")\n        .scale(effectScale * tokenSize)\n        .atLocation(tokenD)\n        .belowTokens() \n        */\n    .play()","ownership":{"default":0,"WskHohnEKJHmL1sC":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.IE5MbNGjRpzXPDZE"}},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1672213058406,"modifiedTime":1673045051601,"lastModifiedBy":"WskHohnEKJHmL1sC"},"folder":null,"sort":0,"_id":"NibmhOLw0plAOp7y"}
{"name":"Fireball","type":"script","author":"WskHohnEKJHmL1sC","img":"modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp","scope":"global","command":"//THIS MACRO NEEDS THE WARPGATE MODULE AND IS INTENDED FOR FIREBALL ONLY.\n//\n\n//TO USE THIS MACRO, you'll need Wasp's \"Sequencer\" module and Honeybadger's Wargate module\n//We cannot recommend reading through the Sequencer wiki enough, to learn how the magic happens : https://github.com/fantasycalendar/FoundryVTT-Sequencer/wiki\n//Although this macro only uses a very, very small part of Warpgate, there is so much more to do and learn from the documentation and wiki : https://github.com/trioderegion/warpgate\n//You can use the \"Show Sequencer Database\" Tool in the toolbar of Foundry to preview all our Fireball explosion animation.\n//Thanks to the module Sequencer, you'll also be able to copy the path of the asset you want in a single click and replace it here to customize the macro.\n\n//It will play the animation of exploding fireball leaving cracks on the ground and choose the right file corresponding to the distance between the caster and the selected position. \n//Don't forget to select the caster before using this macro.\n\n\nlet config = {\n    size:8,\n    icon: 'modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballExplosion_01_Orange_Thumb.webp',\n    label: 'Fireball',\n    tag: 'chop power',\n    drawIcon: true,\n    drawOutline: true,\n    interval: 1\n}\n\n\nconst selected = canvas.tokens.controlled[0];\nlet position = await warpgate.crosshairs.show(config);\n\nlet sequence = new Sequence()\n\n    .effect()\n        .file(\"jb2a.fireball.beam.orange\")\n        .atLocation(selected)\n        .stretchTo(position)\n    .effect()\n        .file(\"jb2a.fireball.explosion.orange\")\n        .atLocation(position)\n        .delay(2100)\n    .effect()\n        .file(\"jb2a.ground_cracks.orange.01\")\n//        .file(\"modules/jb2a_patreon/Library/3rd_Level/Fireball/FireballBlast_01_Orange_800x800.webm\") //This file isn't part of our module, but it can be downloaded here : https://www.dropbox.com/s/7z72w0cjznx6yeo/Modified_Blast_Tile_From_ForgottenAdventures.zip?dl=1\n        .atLocation(position)\n        .belowTokens()\n        .scaleIn(0.5, 150, {ease: \"easeOutExpo\"})\n        .duration(5000)\n        .fadeOut(3250, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .delay(2300)\n        .waitUntilFinished(-3250)\n    .effect()\n        .file(\"jb2a.impact.ground_crack.still_frame.01\")\n        .atLocation(position)\n        .belowTokens()\n        .fadeIn(300, {ease: \"easeInSine\"})\n        .name(\"Fireball_Impact\")\n        .persist()\n.play();","flags":{"core":{"sourceId":"Macro.cNDVcu9Iut7LYUsg"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"fgJl9vo2lDyR201q":3,"WskHohnEKJHmL1sC":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.291","createdTime":1672210764444,"modifiedTime":1673045055160,"lastModifiedBy":"WskHohnEKJHmL1sC"},"folder":null,"sort":0,"_id":"LeBI0Acl2WqfEvlW"}
